From c2d51675287343c9006256397ae50709ed2cc892 Mon Sep 17 00:00:00 2001
From: David Robillard <d@drobilla.net>
Date: Wed, 16 Jul 2014 03:30:54 +0000
Subject: Fix initial noise with Piano (zero comb filter and voices on startup)
 (fix #974).

git-svn-id: http://svn.drobilla.net/lad/trunk/plugins/mda.lv2@5415 a436a847-0d15-0410-975c-d299462d15a1
---
 NEWS             | 6 ++++++
 src/mdaPiano.cpp | 2 ++
 src/mdaPiano.h   | 2 +-
 3 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/NEWS b/NEWS
index 536210b..c965726 100644
--- a/NEWS
+++ b/NEWS
@@ -1,3 +1,9 @@
+mda-lv2 (1.2.3) unstable;
+
+  * Fix initial noise with Piano (zero comb filter and voices on startup)
+
+ -- David Robillard <d@drobilla.net>  Tue, 15 Jul 2014 23:25:05 -0400
+
 mda-lv2 (1.2.2) stable;
 
   * Fix compilation against LV2 < 1.8.0
diff --git a/src/mdaPiano.cpp b/src/mdaPiano.cpp
index a81ed03..75df330 100644
--- a/src/mdaPiano.cpp
+++ b/src/mdaPiano.cpp
@@ -108,6 +108,7 @@ mdaPiano::mdaPiano(audioMasterCallback audioMaster) : AudioEffectX(audioMaster,
   //initialise...
   for(int32_t v=0; v<NVOICES; v++)
   {
+    memset(&voice[v], 0, sizeof(voice[v]));
     voice[v].env = 0.0f;
     voice[v].dec = 0.99f; //all notes off
   }
@@ -115,6 +116,7 @@ mdaPiano::mdaPiano(audioMasterCallback audioMaster) : AudioEffectX(audioMaster,
   muff = 160.0f;
   cpos = sustain = activevoices = 0;
   comb = new float[256];
+  memset(comb, 0, sizeof(float) * 256);
 
   guiUpdate = 0;
 
diff --git a/src/mdaPiano.h b/src/mdaPiano.h
index 012fcee..d03d2a8 100644
--- a/src/mdaPiano.h
+++ b/src/mdaPiano.h
@@ -127,7 +127,7 @@ private:
   int32_t  cmax;
   float *comb, cdep, width, trim;
   int32_t  size, sustain;
-  float tune, fine, random, stretch;
+  float fine, random, stretch;
   float muff, muffvel, sizevel, velsens, volume;
 };
 
-- 
cgit v1.2.1

