language: cpp

os: linux

dist: bionic

cache:
  directories:
  - ${HOME}/PawPawBuilds/debs
  - ${HOME}/PawPawBuilds/downloads

jobs:
  include:
    # linux native build
    - os: linux
      compiler: gcc
      env:
        - TARGET="linux"
        - PLUGINS="abgate artyfx blop caps fomp mda"

    # linux with macOS cross-compilation
    - os: linux
      compiler: gcc
      env:
        - TARGET="macos-old"
        - PLUGINS="abgate artyfx caps fomp mda"

    # linux with win32 cross-compilation
    - os: linux
      compiler: gcc
      env:
        - TARGET="win32"
        - PLUGINS="abgate artyfx blop caps fomp mda"
      services:
        - xvfb

    # linux with win64 cross-compilation
    - os: linux
      compiler: gcc
      env:
        - TARGET="win64"
        - PLUGINS="abgate artyfx blop caps fomp mda"
      services:
        - xvfb

    # macOS native build (default)
    - os: osx
      compiler: gcc
      env:
        - TARGET="macos"
        - PLUGINS="abgate artyfx blop caps fomp mda"

    # macOS native build (older compatibility mode)
    - os: osx
      compiler: gcc
      env:
        - TARGET="macos"
        - PLUGINS="abgate artyfx blop caps fomp mda"
      osx_image: xcode7.3

before_install:
  - bash ${TRAVIS_BUILD_DIR}/.travis/before_install.sh

install:
  - bash ${TRAVIS_BUILD_DIR}/.travis/install.sh

script:
  - bash ${TRAVIS_BUILD_DIR}/bootstrap.sh ${TARGET}
  - bash ${TRAVIS_BUILD_DIR}/build-plugins.sh ${TARGET} ${PLUGINS}

before_deploy:
  - bash ${TRAVIS_BUILD_DIR}/pack-plugins.sh ${TARGET} ${PLUGINS}

deploy:
  provider: releases
  api_key:
    secure: "xKXvMWEvj92IsFINpGlYEJeidLRoTeLIwrWVO06UrNNVCPiWC9z64Xthx/0xqQEv+2PA5GLkh9lnTm7aqQKbMNiVj4sQCcg3sVXEhkGkr27KNjHuQiFao+IeotU6bVTObzGhNR+US3LkRK9RSSvnmDBSUQB16+YgG6PZyXH7mQfoLycQQ8z24hLc4P2gGXbgd23viqZVxBh15HBm8jSm0q5Y5JZ2D/ETQWIijv+Cd7f3Q4j989Q4ZULiDyPs6gMR6Klr85Z8iNXEZRCw/dJ800IrWV9tetJFZFVOG2nWATPSFD9L1DLlJtD0tPJjk/n7DpUEivdrrLgm2C1MaTfDWQU7OOktkcNv6oUB++hWqD/d9bj1teSu9lrUkAS4QPWGWgsMQH/eWquoS6vQOE7ERAHTDgbsS1aPxnuWyG2lyefbSEJCXBOpbcWLAfAr3cdkS+QhFHZzKvZLwJZFkKR0FEKKPkt+CViLmtSbeM7uFRhX3B4uA9EByZonlvupgKfyt/WKoqpsb1hF16tVrZOmTFf2/btLOw8PUD1opAx0aXjH+XcWH6y93wsP41E3VMO/gc8jc7npa+JsMDXaHFf/DMQvj9rVF8deHoshx8Sl3n0RpEhMyV+lXKKfewryqnfWNGak7wNQQhFr4Xqv6mleBFAX1Miy12KkzYxltfwi53o="
  file_glob: true
  file: setup/inno/PawPaw-*.exe
  skip_cleanup: true
  on:
    tags: true

#notifications:
  #email: true
  #irc: "ircs://chat.freenode.net:7070/#kxstudio"
